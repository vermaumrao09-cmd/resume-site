<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Insta Reel Downloader - Final Fix</title>
    <style>
        body { font-family: sans-serif; background: #09090b; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #18181b; padding: 2rem; border-radius: 15px; border: 1px solid #27272a; width: 100%; max-width: 400px; text-align: center; }
        input { width: 100%; padding: 12px; margin-bottom: 20px; border-radius: 8px; border: 1px solid #27272a; background: #000; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: linear-gradient(45deg, #f09433, #dc2743); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }
        #status { margin-top: 20px; font-size: 0.9rem; color: #94a3b8; }
        .dl-link { display: block; margin-top: 15px; color: #22c55e; font-weight: bold; text-decoration: none; border: 1px solid #22c55e; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>Reel Downloader</h2>
        <input type="text" id="urlInput" placeholder="Paste Instagram Link Here...">
        <button onclick="processDownload()">Download Video</button>
        <div id="status"></div>
    </div>

    <script>
        // Source code se nikala gaya logic
        const SALT = "Khushi_Secret_Salt_2026"; 
        const PROXY = "https://api.allorigins.win/raw?url="; 

        async function makeSignature(token, url) {
            const message = token + url + SALT;
            const encoder = new TextEncoder();
            const data = encoder.encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-1', data);
            return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function processDownload() {
            const url = document.getElementById('urlInput').value.trim();
            const status = document.getElementById('status');
            const target = "https://cdn4.fizbk4.workers.dev"; // Original API

            if(!url) return alert("Link daalein!");
            status.innerHTML = "Processing... (Bypassing Bot Detection)";

            try {
                // 1. Token lein
                const tResp = await fetch(PROXY + encodeURIComponent(target + "/get-token"));
                const tData = await tResp.json();
                const token = tData.token;

                // 2. Signature banayein
                const sig = await makeSignature(token, url);

                // 3. Main Request (Directly from browser via AllOrigins)
                const response = await fetch(PROXY + encodeURIComponent(target + "/"), {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        url: url,
                        "X-Token-ID": token,
                        "X-Signature": sig
                    })
                });

                const data = await response.json();
                if(data.url) {
                    status.innerHTML = `<a href="${data.url}" target="_blank" class="dl-link">âœ” Video Taiyaar Hai (Download)</a>`;
                } else {
                    status.innerHTML = "<span style='color:red;'>Failed: Link nahi mila.</span>";
                }
            } catch (err) {
                status.innerHTML = "<span style='color:red;'>Error: Security block ho gayi hai.</span>";
            }
        }
    </script>
</body>
</html>
